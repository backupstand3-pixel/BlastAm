var FollowCamera=pc.createScript("followCamera");FollowCamera.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),FollowCamera.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),FollowCamera.prototype.initialize=function(){this.pos=new pc.Vec3,this.offset=new pc.Vec3},FollowCamera.prototype.postUpdate=function(t){this.target&&(this.offset.set(.75,1,.75).scale(this.distance),this.pos.copy(this.target.getPosition()).add(this.offset),this.pos.lerp(this.entity.getPosition(),this.pos,.1),this.entity.setPosition(this.pos))};var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3,this.spawnPos=this.entity.getPosition().clone()},Movement.prototype.update=function(e){if(this.entity.getPosition().y<-1)return void this.teleport(this.spawnPos);const t=this.app.keyboard;let s=0,i=0;if((t.isPressed(pc.KEY_LEFT)||t.isPressed(pc.KEY_A))&&(s=-this.speed),(t.isPressed(pc.KEY_RIGHT)||t.isPressed(pc.KEY_D))&&(s+=this.speed),(t.isPressed(pc.KEY_UP)||t.isPressed(pc.KEY_W))&&(i=-this.speed),(t.isPressed(pc.KEY_DOWN)||t.isPressed(pc.KEY_S))&&(i+=this.speed),this.force.set(s,0,i),this.force.lengthSq()>0){this.force.normalize().scale(this.speed);const e=.25*-Math.PI,t=Math.cos(e),s=Math.sin(e),i=this.force.x*t-this.force.z*s,o=this.force.z*t+this.force.x*s;this.force.set(i,0,o)}this.entity.rigidbody.applyImpulse(this.force)},Movement.prototype.teleport=function(e){this.entity.rigidbody.teleport(e),this.spawnPos.copy(e),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO};var Teleporter=pc.createScript("teleporter");Teleporter.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleporter.prototype.initialize=function(){const onTriggerEnter=t=>{if(t.script.movement){const e=this.target.getPosition().clone();e.y+=.5,t.script.movement.teleport(e)}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var Movesrpt=pc.createScript("movesrpt");Movesrpt.prototype.initialize=function(){},Movesrpt.prototype.update=function(t){};var CharacterController=pc.createScript("movescript");CharacterController.attributes.add("moveSpeed",{type:"number",default:3,title:"Move Speed"}),CharacterController.prototype.initialize=function(){this.animComponent=this.entity.anim,this.animComponent&&(this.animComponent.setBoolean("Walk",!1),this.animComponent.setBoolean("Walk2",!1),this.animComponent.setBoolean("Idle",!0)),this.isMovingLeft=!1,this.isMovingRight=!1,this.entity.rigidbody||console.error("Entity needs a RigidBody (Dynamic)!"),this.entity.collision||console.error("Entity needs a Collision component!"),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.keyboard.on(pc.EVENT_KEYUP,this.onKeyUp,this)},CharacterController.prototype.onKeyDown=function(o){this.animComponent&&(o.key===pc.KEY_LEFT&&(this.isMovingRight=!0,this.isMovingLeft=!1,this.animComponent.setBoolean("Walk2",!0),this.animComponent.setBoolean("Walk",!1),this.animComponent.setBoolean("Idle",!1)),o.key===pc.KEY_RIGHT&&(this.isMovingLeft=!0,this.isMovingRight=!1,this.animComponent.setBoolean("Walk",!0),this.animComponent.setBoolean("Walk2",!1),this.animComponent.setBoolean("Idle",!1)))},CharacterController.prototype.onKeyUp=function(o){this.animComponent&&(o.key===pc.KEY_LEFT&&(this.isMovingRight=!1,this.animComponent.setBoolean("Walk2",!1)),o.key===pc.KEY_RIGHT&&(this.isMovingLeft=!1,this.animComponent.setBoolean("Walk",!1)),this.app.keyboard.isPressed(pc.KEY_LEFT)||this.app.keyboard.isPressed(pc.KEY_RIGHT)||this.animComponent.setBoolean("Idle",!0))},CharacterController.prototype.update=function(o){if(!this.entity.rigidbody)return;const t=this.moveSpeed,n=this.entity.right,e=this.entity.rigidbody.linearVelocity.clone();e.x=0,e.z=0,this.isMovingLeft?e.add(n.clone().scale(-t)):this.isMovingRight&&e.add(n.clone().scale(t)),this.entity.rigidbody.linearVelocity=e,this.isMovingLeft||this.isMovingRight?this.animComponent.setBoolean("Idle",!1):(this.animComponent.setBoolean("Idle",!0),this.animComponent.setBoolean("Walk",!1),this.animComponent.setBoolean("Walk2",!1)),this.isMovingLeft||this.isMovingRight?this.animComponent.setBoolean("Idle",!1):(this.animComponent.setBoolean("Idle",!0),this.animComponent.setBoolean("Walk",!1),this.animComponent.setBoolean("Walk2",!1)),this.isMovingLeft&&!this.animComponent.getBoolean("Walk")?(this.animComponent.setBoolean("Walk",!0),this.animComponent.setBoolean("Walk2",!1),this.animComponent.setBoolean("Idle",!1)):this.isMovingRight&&!this.animComponent.getBoolean("Walk2")?(this.animComponent.setBoolean("Walk2",!0),this.animComponent.setBoolean("Walk",!1),this.animComponent.setBoolean("Idle",!1)):this.isMovingLeft||this.isMovingRight||(this.animComponent.setBoolean("Idle",!0),this.animComponent.setBoolean("Walk",!1),this.animComponent.setBoolean("Walk2",!1))};// BoundaryScript.js


const PlayerController=pc.createScript("playerController");PlayerController.prototype.initialize=function(){this.entity.addComponent("collision",{type:"capsule",radius:.5,height:1.8}),this.entity.addComponent("rigidbody",{type:"dynamic",mass:70,linearDamping:.1,angularDamping:.1})};var PlayerShooting=pc.createScript("playerShooting");PlayerShooting.attributes.add("bulletPrefab",{type:"entity",title:"Music Note Prefab"}),PlayerShooting.attributes.add("shootForce",{type:"number",default:20,title:"Shoot Force"}),PlayerShooting.attributes.add("shootCooldown",{type:"number",default:.3,title:"Shoot Cooldown (s)"}),PlayerShooting.prototype.initialize=function(){this.lastShotTime=0,this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},PlayerShooting.prototype.onKeyDown=function(t){t.key===pc.KEY_X&&this.shoot()},PlayerShooting.prototype.shoot=function(){let t=performance.now();if(t-this.lastShotTime<1e3*this.shootCooldown)return;if(this.lastShotTime=t,!this.bulletPrefab)return void console.error("‚ö†Ô∏è Assign your Music Note Prefab in the Inspector!");let o=this.bulletPrefab.clone();o.enabled=!0,o.findComponents("render").forEach((t=>t.enabled=!0)),this.app.root.addChild(o);let e=this.entity.getPosition(),i=this.entity.forward;o.setPosition(e.clone().add(i.clone().scale(1.5)));let n=o.rigidbody;n&&(n.linearVelocity=i.clone().scale(this.shootForce)),setTimeout((()=>{o&&o.destroy&&o.destroy()}),3e3)};var BulletCollision=pc.createScript("bulletCollision");BulletCollision.prototype.initialize=function(){this.entity.collision.on("collisionstart",this.onCollisionStart,this)},BulletCollision.prototype.onCollisionStart=function(o){o.other.tags.has("zombie")&&(console.log("üí• Hit a zombie!"),o.other.destroy(),this.entity.destroy())};var Bullet=pc.createScript("bullet");Bullet.attributes.add("speed",{type:"number",default:50}),Bullet.attributes.add("lifetime",{type:"number",default:3}),Bullet.attributes.add("explosionPrefab",{type:"asset",assetType:"template",title:"Explosion Particles"}),Bullet.attributes.add("shootSound",{type:"asset",assetType:"audio"}),Bullet.attributes.add("explosionSound",{type:"asset",assetType:"audio"}),Bullet.attributes.add("sfxVolume",{type:"number",default:.6}),Bullet.prototype.initialize=function(){if(this.startPos=this.entity.getPosition().clone(),this.timeAlive=0,!1!==this.app.soundEnabled&&this.shootSound&&this.shootSound.resource){var t=new pc.Entity;t.addComponent("sound"),t.sound.addSlot("shoot",{asset:this.shootSound.id,volume:this.sfxVolume,autoPlay:!0,overlap:!0}),this.app.root.addChild(t),setTimeout((()=>t.destroy()),1e3)}},Bullet.prototype.update=function(t){if(this.timeAlive+=t,this.timeAlive>this.lifetime)return void this.entity.destroy();const e=this.entity.forward.clone().mulScalar(this.speed*t),o=this.entity.getPosition().clone().add(e);this.entity.setPosition(o);const i=o,s=this.app.root.findByName("ActiveAirDrop");if(s&&s.enabled){const t=s.getPosition().distance(i);if(t<2)return console.log("%c ACTIVE AIRDROP HIT!!! Distance:",t.toFixed(2),"background:#ff1493;color:#fff;font-size:24px;font-weight:bold"),this.spawnBulletExplosion(s.getPosition()),this.entity.destroy(),void this.app.fire("airdrop:hit",s)}const n=this.startPos.clone(),l=o.clone(),a=this.app.systems.rigidbody.raycastFirst(n,l);a&&a.entity?this.hit(a.entity,a.point):this.startPos=o.clone()},Bullet.prototype.hit=function(t,e){console.log("Bullet hit:",t.name);let o=t,i=0;for(;o&&i<10;){if(i++,o.script&&o.script.zombieController){o.script.zombieController.die(e);break}o=o.parent}if(!1!==this.app.soundEnabled&&this.explosionSound&&this.explosionSound.resource){var s=new pc.Entity;s.addComponent("sound"),s.sound.addSlot("explosion",{asset:this.explosionSound.id,volume:this.sfxVolume,autoPlay:!0,overlap:!0}),s.setPosition(e),this.app.root.addChild(s),setTimeout((()=>s.destroy()),2e3)}this.spawnBulletExplosion(e),this.entity.destroy()},Bullet.prototype.spawnBulletExplosion=function(t){if(!this.explosionPrefab||!this.explosionPrefab.resource)return;const e=this.explosionPrefab.resource.instantiate();e.setPosition(t),this.app.root.addChild(e),setTimeout((()=>e&&e.destroy()),2e3)};var Health=pc.createScript("health");Health.prototype.initialize=function(){this.camera=this.app.root.findByName("Camera"),this.health=this.entity.children[0]},Health.prototype.postUpdate=function(t){this.entity.lookAt(this.camera.getPosition()),this.entity.rotateLocal(90,180,0)},Health.prototype.setHealth=function(t){var e=this.health.getLocalScale(),a=+e.x+t/10;a>0?this.health.setLocalScale(pc.math.clamp(a,0,1),e.y,e.z):this.entity.parent.destroy()};var Shoot=pc.createScript("shoot");Shoot.attributes.add("playerModel",{type:"entity",title:"Player Model (For Glow)"}),Shoot.attributes.add("bulletSpeedMultiplier",{type:"number",default:1,title:"Current Bullet Speed Multiplier"}),Shoot.attributes.add("boostFireRate",{type:"number",default:.03,title:"Fire Rate During Rage Boost (seconds)"}),Shoot.attributes.add("normalFireRate",{type:"number",default:.9,title:"Normal Fire Rate (seconds)"}),Shoot.attributes.add("mobileFireRate",{type:"number",default:.9,title:"Mobile Shoot Button Cooldown (seconds)"}),Shoot.prototype.mobileNextFireTime=0,Shoot.prototype.mobileShootPressed=!1,Shoot.prototype.initialize=function(){if(console.log("[Shoot] Initializing..."),this.findBulletTemplate(),this.bullet?(this.bullet.enabled=!1,this.baseSpeed=this.bullet.script?.bullet?.speed||50,console.log("Bullet FOUND. Base speed:",this.baseSpeed)):console.error("BULLET NOT FOUND! Will retry every shot..."),this.isRageActive=!1,this.fireRate=this.normalFireRate,this.nextFireTime=0,this.app.on("rage:boost",((e,t)=>{this.isRageActive=e,this.bulletSpeedMultiplier=e?t:1,this.fireRate=e?this.boostFireRate:this.normalFireRate,console.log(`RAGE BOOST ${e?"ON":"OFF"} ‚Üí Speed x${this.bulletSpeedMultiplier} | Rate: ${this.fireRate}s`)}),this),this.originalColor=null,this.playerModel){const e=this.playerModel.findByName("Shoot")||this.playerModel;e.render?.meshInstances?.[0]&&(this.originalColor=e.render.meshInstances[0].material.diffuse.clone())}},Shoot.prototype.findBulletTemplate=function(){this.bullet=this.entity.findByName("Bullet")||this.entity.findByPath("Bullet")||this.entity.find((e=>"Bullet"===e.name)),this.bullet&&(this.bullet.enabled=!1)},Shoot.prototype.mobileShoot=function(){const e=performance.now()/1e3;e<this.mobileNextFireTime||(this.fireBullet(),this.mobileNextFireTime=e+this.mobileFireRate,this.startGlow(),this.scheduleGlowStop(),this.playerModel?.anim&&this.playerModel.anim.setTrigger("Shoot"),console.log("MOBILE SHOT! Next shot in 0.9s"))},Shoot.prototype.update=function(e){!this.bullet&&this.entity.enabled&&this.findBulletTemplate();const t=performance.now()/1e3,i=this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT),o=this.app.mouse.wasPressed(pc.MOUSEBUTTON_LEFT);!this.isRageActive&&o&&t>=this.nextFireTime?(this.fireBullet(),this.nextFireTime=t+this.normalFireRate,this.startGlow(),this.scheduleGlowStop()):this.isRageActive&&i&&t>=this.nextFireTime&&(this.fireBullet(),this.nextFireTime=t+this.fireRate,this.startGlow()),!i&&this.stopGlow&&this.stopGlow(),(this.isRageActive&&i||!this.isRageActive&&o)&&this.playerModel?.anim&&this.playerModel.anim.setTrigger("Shoot")},Shoot.prototype.scheduleGlowStop=function(){clearTimeout(this.glowTimeout),this.glowTimeout=setTimeout((()=>{this.stopGlow&&this.stopGlow()}),1e3*this.normalFireRate)},Shoot.prototype.fireBullet=function(){const e=performance.now()/1e3;if(this.isRageActive){if(e<this.nextFireTime)return;this.nextFireTime=e+.03}else{if(e<this.nextFireTime)return;this.nextFireTime=e+.9}if(this.bullet||this.findBulletTemplate(),!this.bullet)return;const t=this.bullet.clone();t.reparent(this.app.root),t.setPosition(this.bullet.getPosition()),t.setRotation(this.bullet.getRotation()),t.setLocalScale(this.bullet.getLocalScale()),t.enabled=!0;const i=this.baseSpeed*this.bulletSpeedMultiplier;t.script?.bullet&&(t.script.bullet.speed=i),console.log(`SHOT | Rage: ${this.isRageActive} | Speed: ${i.toFixed(1)}x`)},Shoot.prototype.fireBulleter=function(){const e=performance.now()/1e3;if(this.isRageActive){if(e<this.nextFireTime)return;this.nextFireTime=e+.03}else{if(e<this.nextFireTime)return;this.nextFireTime=e+.3}if(this.bullet||this.findBulletTemplate(),!this.bullet)return;const t=this.bullet.clone();t.reparent(this.app.root),t.setPosition(this.bullet.getPosition()),t.setRotation(this.bullet.getRotation()),t.setLocalScale(this.bullet.getLocalScale()),t.enabled=!0;const i=this.baseSpeed*this.bulletSpeedMultiplier;t.script?.bullet&&(t.script.bullet.speed=i),console.log(`SHOT | Rage: ${this.isRageActive} | Speed: ${i.toFixed(1)}x`)},Shoot.prototype.startGlow=function(){if(!this.playerModel)return;const e=this.playerModel.findByName("Shoot")||this.playerModel;e.render&&e.render.meshInstances.forEach((e=>{const t=e.material.clone();t.diffuse.set(1,.3,0),t.emissive.set(this.isRageActive?3:1.5,this.isRageActive?1:.3,0),t.update(),e.material=t}))},Shoot.prototype.stopGlow=function(){if(!this.playerModel||!this.originalColor)return;const e=this.playerModel.findByName("Shoot")||this.playerModel;e.render&&e.render.meshInstances.forEach((e=>{const t=e.material.clone();t.diffuse.copy(this.originalColor),t.emissive.set(0,0,0),t.update(),e.material=t}))};var ZombieController=pc.createScript("zombieController");ZombieController.attributes.add("forwardSpeed",{type:"number",default:2,title:"Forward Speed"}),ZombieController.attributes.add("runDelay",{type:"number",default:.5,title:"Start Delay"}),ZombieController.attributes.add("attackDistance",{type:"number",default:1.5,title:"Attack Distance"}),ZombieController.prototype.initialize=function(){this.player=this.app.root.findByName("Player")||this.app.root.findByName("player")||this.app.root.children.find((t=>t.name.toLowerCase().includes("player"))),this.anim=this.entity.anim,this.rigidbody=this.entity.rigidbody,this.player||console.error("Player not found!"),this.anim||console.error("Zombie needs Anim component!"),this.rigidbody&&this.entity.collision||console.error("Zombie needs Rigidbody + Collision!"),this.isRunning=!1,this.isDying=!1,this.isAttacking=!1,this.destroyTimeout=null,this.setupRigidbodyConstraints(),this.setAnim("Idle",!0),this.setAnim("Run",!1),this.setAnim("Attack",!1),setTimeout((()=>this.startRunning()),1e3*this.runDelay)},ZombieController.prototype.setupRigidbodyConstraints=function(){this.rigidbody&&(this.rigidbody.angularFactor=new pc.Vec3(0,1,0),console.log("üõ°Ô∏è Zombie rotation locked (X/Z)"))},ZombieController.prototype.setAnim=function(t,i){if(this.anim)try{this.anim.setBoolean(t,i)}catch(i){console.warn("Anim set failed:",t)}},ZombieController.prototype.startRunning=function(){this.isDying||(this.isRunning=!0,this.setAnim("Idle",!1),this.setAnim("Run",!0))},ZombieController.prototype.update=function(t){if(!this.isDying&&this.isRunning&&this.player){var i=this.entity.getPosition(),e=this.player.getPosition(),o=new pc.Vec3;if(o.sub2(e,i),o.y=0,o.length()<this.attackDistance)return this.isRunning=!1,this.isAttacking=!0,this.setAnim("Run",!1),this.setAnim("Attack",!0),void(this.rigidbody.linearVelocity=pc.Vec3.ZERO);o.normalize();var n=o.scale(this.forwardSpeed);n.y=this.rigidbody.linearVelocity.y,this.rigidbody.linearVelocity=n;var s=Math.atan2(o.x,o.z),r=new pc.Quat;r.setFromEulerAngles(0,s*pc.math.RAD_TO_DEG,0),this.rigidbody.teleport(i,r)}},ZombieController.prototype.die=function(t){console.log("üßü die() called on:",this.entity.name),this.isDying?console.log("die() ignored: zombie already dying"):(this.isDying=!0,this.isRunning=!1,this.isAttacking=!1,this.rigidbody&&(this.rigidbody.linearVelocity=pc.Vec3.ZERO,this.rigidbody.angularVelocity=pc.Vec3.ZERO,this.rigidbody.enabled=!1),this.setAnim("Run",!1),this.setAnim("Attack",!1),this.setAnim("Die",!0),t&&this.spawnExplosion(t),console.log("Firing zombie:died event for:",this.entity.name),this.app.fire("zombie:died",this.entity),this.scheduleDestroy())},ZombieController.prototype.scheduleDestroy=function(){this.destroyTimeout&&clearTimeout(this.destroyTimeout),this.destroyTimeout=setTimeout((()=>{console.log("üßü DESTROYING:",this.entity.name);try{this.entity&&this.entity.parent&&(this.entity.destroy(),console.log("‚úÖ DESTROYED!"))}catch(t){console.log("Destroy ok:",t)}}),1500)},ZombieController.prototype.spawnExplosion=function(t){try{const i=this.app.root.findByScript("bullet");if(i.length>0){const e=i[0].script.bullet;if(e.explosionPrefab&&e.explosionPrefab.resource){const i=e.explosionPrefab.resource.instantiate();i.setPosition(t),this.app.root.addChild(i),setTimeout((()=>{i&&i.parent&&i.destroy()}),2e3)}}}catch(t){console.warn("Explosion failed:",t)}};var ZombieSpawner=pc.createScript("zombieSpawner");ZombieSpawner.attributes.add("zombieTemplate",{type:"asset",assetType:"template",title:"Zombie Template"}),ZombieSpawner.attributes.add("player",{type:"entity",title:"Player Entity"}),ZombieSpawner.attributes.add("waveInterval",{type:"number",default:20,title:"Wave Interval (s)",description:"15-30s random"}),ZombieSpawner.attributes.add("minZombies",{type:"number",default:1,title:"Min Zombies (Normal Wave)"}),ZombieSpawner.attributes.add("maxZombies",{type:"number",default:12,title:"Max Zombies (Normal Wave)"}),ZombieSpawner.attributes.add("surgeChance",{type:"number",default:.1,title:"Surge Chance (0.1 = 10%)"}),ZombieSpawner.attributes.add("minSurge",{type:"number",default:15,title:"Min Surge Zombies"}),ZombieSpawner.attributes.add("maxSurge",{type:"number",default:20,title:"Max Surge Zombies"}),ZombieSpawner.attributes.add("spawnPoints",{type:"entity",title:"Spawn Points (Optional)",description:"Leave empty for auto-find ZombieSpawn1,2..."}),ZombieSpawner.prototype.initialize=function(){this.lastWaveTime=0,this.currentZombies=[],this.isTemplateReady=!1,this.spawnPointList=[],this.player||(this.player=this.app.root.findByName("Player")||this.app.root.findByName("player")||this.app.root.children.find((e=>e.name.toLowerCase().includes("player")))),this.buildSpawnPoints(),this.zombieTemplate&&this.zombieTemplate.resource?this.onTemplateReady():this.zombieTemplate&&(this.zombieTemplate.once("load",this.onTemplateReady,this),this.app.assets.load(this.zombieTemplate)),this.app.on("zombie:died",this.onZombieDied,this),console.log("ZombieSpawner ready!")},ZombieSpawner.prototype.buildSpawnPoints=function(){const e=this.app.root;this.spawnPoints&&this.spawnPointList.push(this.spawnPoints);for(let t=1;t<=20;t++){const i=e.findByName("ZombieSpawn"+t);i&&!this.spawnPointList.includes(i)&&this.spawnPointList.push(i)}0===this.spawnPointList.length&&this.spawnPointList.push(this.entity),console.log(`üßü Found ${this.spawnPointList.length} spawn points`)},ZombieSpawner.prototype.onTemplateReady=function(){this.isTemplateReady=!0,console.log("‚úÖ Zombie template loaded"),setTimeout((()=>this.spawnWave()),1e3)},ZombieSpawner.prototype.update=function(e){if(!this.isTemplateReady)return;const t=performance.now()/1e3;(this.getAliveZombieCount()<=1||t-this.lastWaveTime>=this.waveInterval)&&this.spawnWave()},ZombieSpawner.prototype.getAliveZombieCount=function(){let e=0;for(let t=this.currentZombies.length-1;t>=0;t--){const i=this.currentZombies[t];if(i&&i.parent)try{const t=i.script?.zombieController;t&&!t.isDying&&e++}catch(e){this.currentZombies.splice(t,1)}else this.currentZombies.splice(t,1)}return e},ZombieSpawner.prototype.spawnWave=function(){if(!this.isTemplateReady)return;const e=performance.now()/1e3;if(e-this.lastWaveTime<3)return;let t;Math.random()<this.surgeChance?(t=this.getRandomInt(this.minSurge,this.maxSurge),console.log(`üåä SURGE WAVE! Spawning ${t} zombies!`)):(t=this.getRandomInt(this.minZombies,this.maxZombies),console.log(`üê∫ Normal wave: ${t} zombies`)),this.lastWaveTime=e;for(let e=0;e<t;e++)this.spawnSingleZombie(e,t)},ZombieSpawner.prototype.spawnSingleZombie=function(e,t){const i=this.spawnPointList[e%this.spawnPointList.length],o=e/t*Math.PI*2,n=2*Math.cos(o)*(.5*Math.random()+.5),a=2*Math.sin(o)*(.5*Math.random()+.5),s=new pc.Vec3(n,0,a),r=i.getPosition().clone().add(s);try{const e=this.zombieTemplate.resource.instantiate();e.setPosition(r),this.app.root.addChild(e),e.rigidbody&&e.rigidbody.syncEntityToBody(),this.currentZombies.push(e),setTimeout((()=>{e&&e.script?.zombieController&&(e.script.zombieController.player=this.player)}),50)}catch(e){console.error("Spawn failed:",e)}},ZombieSpawner.prototype.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},ZombieSpawner.prototype.onZombieDied=function(e){const t=this.currentZombies.indexOf(e);-1!==t&&this.currentZombies.splice(t,1)};var MobileButtonController=pc.createScript("mobileButtonController");MobileButtonController.prototype.initialize=function(){},MobileButtonController.prototype.update=function(o){};var MobileButtonController=pc.createScript("mobileButtonController");MobileButtonController.attributes.add("player",{type:"entity",title:"Player Entity"}),MobileButtonController.prototype.initialize=function(){this.player||(this.player=this.entity),this.moveScript=this.player.script.movescript,this.shootScript=this.player.script.shoot,this.moveScript||console.error("Player needs movescript!"),this.shootScript||console.error("Player needs shoot script!"),this.leftButton=this.app.root.findByName("LeftButton"),this.rightButton=this.app.root.findByName("RightButton"),this.fireButton=this.app.root.findByName("FireButton"),this.connectButton(this.leftButton,"left"),this.connectButton(this.rightButton,"right"),this.connectButton(this.fireButton,"fire")},MobileButtonController.prototype.connectButton=function(t,o){t&&t.button?(t.button.on("click",(()=>{this.onButtonPress(o)})),console.log(`‚úÖ ${o.toUpperCase()} button connected`)):console.warn(`Button ${o} not found!`)},MobileButtonController.prototype.onButtonPress=function(t){switch(t){case"left":this.moveScript.isMovingRight=!0,this.moveScript.isMovingLeft=!1;break;case"right":this.moveScript.isMovingLeft=!0,this.moveScript.isMovingRight=!1;break;case"fire":this.shootScript&&this.shootScript.fireBullet&&this.shootScript.fireBullet()}},MobileButtonController.prototype.update=function(t){this.moveScript&&(this.leftButton.button.isPressed||this.rightButton.button.isPressed||(this.moveScript.isMovingLeft=!1,this.moveScript.isMovingRight=!1))};var MobileControls=pc.createScript("mobileControls");MobileControls.prototype.initialize=function(){const o=/Android|iPhone|iPad/i.test(navigator.userAgent);["LeftButton","RightButton","FireButton"].forEach((t=>{const n=this.app.root.findByName(t);n&&(n.enabled=o)})),console.log(o?"üì± Mobile buttons ON":"üñ•Ô∏è Desktop buttons OFF")};var CameraLook=pc.createScript("cameraLook");CameraLook.attributes.add("joystick",{type:"entity"}),CameraLook.attributes.add("lookSpeed",{type:"number",default:80}),CameraLook.prototype.initialize=function(){console.log("%c[CAMERA LOOK] Initialized","color: cyan"),this.joystick||console.error("[CAMERA ERROR] Joystick not assigned!")},CameraLook.prototype.update=function(o){if(!this.joystick)return;let t=this.joystick.script.joystick;if(!t)return void console.error("[CAMERA ERROR] joystick.js missing!");let e=t.direction;console.log("%c[CAMERA] Joystick Dir:","color: pink",e),0!==e.lengthSq()&&this.entity.rotateLocal(0,-e.x*this.lookSpeed*o,0)};var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("joystick",{type:"entity"}),PlayerMovement.attributes.add("speed",{type:"number",default:5}),PlayerMovement.prototype.initialize=function(){console.log("%c[PLAYER MOVEMENT] Initialized","color: cyan"),this.joystick||console.error("[PLAYER MOVEMENT ERROR] Joystick not assigned!")},PlayerMovement.prototype.update=function(e){if(!this.joystick)return;let t=this.joystick.script.joystick;if(!t)return void console.error("[PLAYER MOVEMENT ERROR] joystick.js not found on joystick entity!");let o=t.direction;if(console.log("%c[PLAYER] Joystick Dir:","color: lightgreen",o),0===o.lengthSq())return;let i=new pc.Vec3(o.x,0,-o.y);i.normalize().scale(this.speed*e),console.log("%c[PLAYER] Moving:","color: yellow",i),this.entity.translate(i)};var PlayerMovementFromJoystick=pc.createScript("playerMovementFromJoystick");PlayerMovementFromJoystick.prototype.initialize=function(){if(console.log("[JOY] LEFT JOYSTICK: Initializing..."),this.player=this.app.root.findByName("68e071c81df78dfe0f1d9e5f (1)"),!this.player)return void console.error("[JOY] Player not found");if(this.moveScript=this.player.script.movescript,!this.moveScript)return void console.error("[JOY] movescript missing");if(this.leftJoystick=this.entity.findByName("Left Half Touch Joystick"),!this.leftJoystick)return void console.error("[JOY] Left Half Touch Joystick not found");const findElement=t=>t.element?t:t.children.find((t=>findElement(t)));if(this.touchElement=findElement(this.leftJoystick),!this.touchElement||!this.touchElement.element)return void console.error("[JOY] No Element component in joystick!");console.log("[JOY] Touch area:",this.touchElement.name);const t=this.touchElement.element;t.on("touchstart",this.onStart,this),t.on("touchmove",this.onMove,this),t.on("touchend",this.onEnd,this),t.on("mousedown",this.onStart,this),t.on("mousemove",this.onMove,this),t.on("mouseup",this.onEnd,this),this.isDragging=!1,this.startX=0,console.log("[JOY] LEFT JOYSTICK READY ‚Äì RELIABLE DRAG")},PlayerMovementFromJoystick.prototype.onStart=function(t){this.isDragging=!0,this.startX=t.x||t.changedTouches?.[0]?.screenX||0,this.handleInput(0),t.event&&t.event.preventDefault(),console.log("[JOY] TOUCH START")},PlayerMovementFromJoystick.prototype.onMove=function(t){if(!this.isDragging)return;const o=(t.x||t.changedTouches?.[0]?.screenX||0)-this.startX;this.handleInput(o),t.event&&t.event.preventDefault()},PlayerMovementFromJoystick.prototype.onEnd=function(t){this.isDragging=!1,this.stop(),console.log("[JOY] TOUCH END ‚Üí IDLE"),t.event&&t.event.preventDefault()},PlayerMovementFromJoystick.prototype.handleInput=function(t){Math.abs(t)<20?this.stop():t<0?this.moveLeft():this.moveRight()},PlayerMovementFromJoystick.prototype.moveLeft=function(){this.moveScript.isMovingRight=!0,this.moveScript.isMovingLeft=!1},PlayerMovementFromJoystick.prototype.moveRight=function(){this.moveScript.isMovingLeft=!0,this.moveScript.isMovingRight=!1},PlayerMovementFromJoystick.prototype.stop=function(){this.moveScript.isMovingLeft=!1,this.moveScript.isMovingRight=!1};var CameraRotationFromJoystick=pc.createScript("cameraRotationFromJoystick");CameraRotationFromJoystick.attributes.add("rotateSpeed",{type:"number",default:2,title:"Rotate Speed"}),CameraRotationFromJoystick.prototype.initialize=function(){if(this.camera=this.findCamera(),!this.camera)return void console.error("NO CAMERA FOUND! Add Camera component to an entity.");if(this.rightJoystick=this.entity.findByName("Right Fixed Touch Joystick"),!this.rightJoystick)return void console.error("Right Fixed Touch Joystick NOT FOUND!");const t=this.rightJoystick.element||this.rightJoystick.findByName("Base").element||this.rightJoystick.findByName("Nub").element;t?(console.log("‚úÖ RIGHT JOYSTICK ‚Üí CAMERA:",this.camera.name),t.on("touchstart",this.onTouchStart,this),t.on("touchmove",this.onTouchMove,this),t.on("touchend",this.onTouchEnd,this),t.on("mousedown",this.onTouchStart,this),t.on("mousemove",this.onTouchMove,this),t.on("mouseup",this.onTouchEnd,this),this.isDraggingRight=!1,this.lastTouchX=0,this.lastTouchY=0):console.error("No Element found on Right Joystick!")},CameraRotationFromJoystick.prototype.findCamera=function(){const t=this.app.root.children;for(let o of t){if(o.camera)return o;const t=this.findCameraInChildren(o);if(t)return t}return null},CameraRotationFromJoystick.prototype.findCameraInChildren=function(t){if(t.camera)return t;for(let o of t.children){const t=this.findCameraInChildren(o);if(t)return t}return null},CameraRotationFromJoystick.prototype.onTouchStart=function(t){this.isDraggingRight=!0,this.lastTouchX=t.x,this.lastTouchY=t.y,t.stopPropagation()},CameraRotationFromJoystick.prototype.onTouchMove=function(t){if(!this.isDraggingRight)return;const o=t.x-this.lastTouchX,i=t.y-this.lastTouchY,e=.005*o*this.rotateSpeed,n=.005*-i*this.rotateSpeed,r=this.camera.getEulerAngles();this.camera.setEulerAngles(pc.math.clamp(r.x+n,-80,80),r.y+e,0),this.lastTouchX=t.x,this.lastTouchY=t.y,t.preventDefault(),t.stopPropagation()},CameraRotationFromJoystick.prototype.onTouchEnd=function(t){this.isDraggingRight=!1,t.stopPropagation()};var MobileEnforcer=pc.createScript("mobileEnforcer");MobileEnforcer.prototype.initialize=function(){console.log("[DEBUG] MOBILE ENFORCER: Checking device...");const o=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);console.log("[DEBUG] Is mobile?",o);const e=this.app.root.findByName("2D Joypad Screen");e?(e.enabled=o,console.log("[DEBUG] Joypad UI:",o?"ENABLED":"DISABLED")):console.error("[DEBUG] 2D Joypad Screen not found!")};var AttackButton=pc.createScript("attackButton");AttackButton.prototype.initialize=function(){return this.player=this.app.root.findByName("68e071c81df78dfe0f1d9e5f (1)"),this.player?(this.shootScript=this.player.script.shoot,this.shootScript?void this.entity.button.on("click",(()=>{this.shootScript.fireBullet&&(this.shootScript.fireBullet(),this.player.anim&&this.player.anim.setTrigger("Shoot"),console.log("[Attack] FIRED!"))})):console.error("shoot script missing")):console.error("Player not found")};var AirDrop=pc.createScript("airDrop");AirDrop.prototype.initialize=function(){this.spawner=null,this.boostManager=null},AirDrop.prototype.update=function(t){this.entity.rotate(0,30*t,0)},AirDrop.prototype.hit=function(t){this.entity.destroy(),this.spawner&&this.spawner.onAirDropDestroyed(),this.boostManager&&this.boostManager.addBoost(.2),console.log("ü™Ç AirDrop destroyed ‚Äì Boost +20%")};var AirDropSpawner=pc.createScript("airDropSpawner");AirDropSpawner.attributes.add("airDropTemplate",{type:"asset",assetType:"template",title:"Air Drop Template (MUST ASSIGN!)"}),AirDropSpawner.attributes.add("boostManager",{type:"entity",title:"Boost Manager Entity"}),AirDropSpawner.attributes.add("spawnInterval",{type:"number",default:30,title:"Spawn Every X Seconds"}),AirDropSpawner.attributes.add("airDropLifetime",{type:"number",default:10,title:"Airdrop Lifetime if not shot (seconds)"}),AirDropSpawner.prototype.initialize=function(){if(this.airDropSpots=[],this.activeAirDrop=null,this.lastSpawnTime=0,this.lifetimeTimer=null,this.airDropTemplate&&this.airDropTemplate.resource){for(let t=1;t<=10;t++){const r=this.app.root.findByName("AirDropSpot"+t);r&&this.airDropSpots.push(r)}0!==this.airDropSpots.length?(this.app.on("airdrop:hit",this.onAirdropHitByBullet,this),console.log(`AirDropSpawner READY ‚Äì ${this.airDropSpots.length} spots`),this.spawnAirDrop()):console.error("Create entities named: AirDropSpot1 to AirDropSpot10")}else console.error("AirDropSpawner: NO TEMPLATE ASSIGNED!")},AirDropSpawner.prototype.spawnAirDrop=function(){if(this.activeAirDrop||!this.airDropTemplate?.resource)return;const t=this.airDropSpots[Math.floor(Math.random()*this.airDropSpots.length)],r=this.airDropTemplate.resource.instantiate();r.name="ActiveAirDrop",r.tags.add("airdrop"),r.setPosition(t.getPosition()),this.app.root.addChild(r);const i=r.script?.airDrop;i&&(i.spawner=this,i.boostManager=this.boostManager?.script?.boostManager),this.activeAirDrop=r,this.lastSpawnTime=performance.now()/1e3,console.log("%c AIRDROP SPAWNED ‚Äì will auto-destroy in "+this.airDropLifetime+"s","color: cyan; font-weight: bold"),this.lifetimeTimer=setTimeout((()=>{this.destroyActiveAirdrop("timeout")}),1e3*this.airDropLifetime)},AirDropSpawner.prototype.onAirdropHitByBullet=function(t){this.activeAirDrop&&t===this.activeAirDrop&&(console.log("%c AIRDROP SHOT BY BULLET ‚Äì destroying instantly!","color: red; font-weight: bold"),this.destroyActiveAirdrop("shot"))},AirDropSpawner.prototype.destroyActiveAirdrop=function(t){this.activeAirDrop&&(clearTimeout(this.lifetimeTimer),this.activeAirDrop.destroy(),this.activeAirDrop=null,this.lifetimeTimer=null,"shot"===t&&this.app.fire("airdrop:shot"),console.log("%c Airdrop destroyed ("+t+")","color: orange; font-weight: bold"))},AirDropSpawner.prototype.update=function(t){if(!this.activeAirDrop){performance.now()/1e3-this.lastSpawnTime>this.spawnInterval&&this.spawnAirDrop()}},AirDropSpawner.prototype.onDestroy=function(){this.app.off("airdrop:hit",this.onAirdropHitByBullet,this),clearTimeout(this.lifetimeTimer)};var BoostManager=pc.createScript("boostManager");BoostManager.attributes.add("progressFill",{type:"entity",title:"Boost Fill Entity (the bar that grows)"}),BoostManager.attributes.add("player",{type:"entity",title:"Player Entity (with shoot script)"}),BoostManager.attributes.add("boostPerDrop",{type:"number",default:.2}),BoostManager.attributes.add("fullBoostMultiplier",{type:"number",default:.5}),BoostManager.prototype.initialize=function(){this.currentBoost=0,this.originalCooldown=.1,this.player&&this.player.script?.shoot&&(this.shootScript=this.player.script.shoot,this.originalCooldown=this.shootScript.cooldown||.1),this.updateVisual()},BoostManager.prototype.addBoost=function(t){this.currentBoost=Math.min(1,this.currentBoost+(t||this.boostPerDrop)),console.log(`Boost: ${Math.round(100*this.currentBoost)}%`),this.updateVisual(),this.applyBoostToShooting()},BoostManager.prototype.updateVisual=function(){if(this.progressFill?.element){this.progressFill.element.width=200*this.currentBoost;const t=this.currentBoost>=1?pc.Color.YELLOW:pc.Color.CYAN;this.progressFill.element.color=t}},BoostManager.prototype.applyBoostToShooting=function(){if(!this.shootScript)return;const t=1-this.currentBoost*(1-this.fullBoostMultiplier);this.shootScript.cooldown=this.originalCooldown*t},BoostManager.prototype.resetBoost=function(){this.currentBoost=0,this.shootScript&&(this.shootScript.cooldown=this.originalCooldown),this.updateVisual()};var AirdropTrigger=pc.createScript("airdropTrigger");AirdropTrigger.attributes.add("bulletPrefab",{type:"entity",title:"Bullet Prefab / Entity",description:"Drag your music note bullet here (used only for comparison)"}),AirdropTrigger.prototype.initialize=function(){this.entity.collision&&(this.entity.collision.isTrigger=!0,this.entity.rigidbody||this.entity.addComponent("rigidbody",{type:pc.BODYTYPE_KINEMATIC}),this.entity.collision.on("triggerenter",this.onTriggerEnter,this),console.log("%c Airdrop trigger ACTIVE ‚Äì waiting for bullet","background:#00ff00;color:#000;padding:5px 10px;font-weight:bold")),AirdropTrigger.prototype.onTriggerEnter=function(t){const e=t.script&&(t.script.bullet||t.script.Bullet||t.script.musicNoteBullet||t.script.MusicNoteBullet),i=this.bulletPrefab&&t.getGuid&&t.getGuid()===this.bulletPrefab.getGuid(),r=this.bulletPrefab&&t.template&&this.bulletPrefab.template;e||i||r||t.name.toLowerCase().includes("bullet")||t.name.toLowerCase().includes("note")?(console.log("%c BULLET HIT AIRDROP ‚Äì DESTROYING BULLET!","background:#ffff00;color:#000;font-size:18px;font-weight:bold"),t&&t.destroy&&t.destroy(),this.entity.fire("airdrop:hit")):console.log("Non-bullet entered trigger:",t.name)}};var AirDropLifetime=pc.createScript("airDropLifetime");AirDropLifetime.attributes.add("lifetime",{type:"number",default:10,title:"Lifetime if not shot (seconds)"}),AirDropLifetime.prototype.initialize=function(){this.timeout=setTimeout((()=>{this.entity&&(console.log("%c AirDrop timed out ‚Äì disappearing","color: orange; font-weight: bold"),this.entity.destroy())}),1e3*this.lifetime),this.app.on("airdrop:hit",this.onHitByBullet,this)},AirDropLifetime.prototype.onHitByBullet=function(t){t===this.entity&&(console.log("%c AirDrop SHOT ‚Äì destroying immediately!","color: red; font-weight: bold"),clearTimeout(this.timeout),this.entity.destroy())},AirDropLifetime.prototype.onDestroy=function(){this.app.off("airdrop:hit",this.onHitByBullet,this),clearTimeout(this.timeout)};var RageMeter=pc.createScript("rageMeter");RageMeter.attributes.add("boostDuration",{type:"number",default:10,title:"Seconds per Bar"}),RageMeter.attributes.add("boostMultiplier",{type:"number",default:2,title:"Speed Multiplier"}),RageMeter.attributes.add("shootEntity",{type:"entity",title:"Player (with shoot.js)"}),RageMeter.prototype.initialize=function(){this.count=0,this.maxCount=10,this.isHolding=!1,this.rageActive=!1,this.rageEndTime=0,this.bars=[];for(let t=1;t<=10;t++){const e=this.entity.findByName("Bar"+t);e&&(e.element.opacity=0,this.bars.push(e))}this.boostButton=this.entity.findByName("BoostButton"),this.boostLabel=this.entity.findByName("Label"),this.boostButton&&this.shootEntity?(this.setButtonEnabled(!1),this.boostButton.button.on("mousedown",(()=>this.tryStartRage())),this.boostButton.button.on("touchstart",(t=>{t.event.preventDefault(),this.tryStartRage()})),this.app.mouse.on("mouseup",(()=>this.isHolding=!1)),this.app.touch&&this.app.touch.on("touchend",(()=>this.isHolding=!1)),this.app.on("airdrop:shot",(()=>{this.count<this.maxCount&&(this.count++,this.updateVisuals())}))):console.error("Missing BoostButton or shootEntity!")},RageMeter.prototype.tryStartRage=function(){this.count<=0||this.rageActive||(this.isHolding=!0,this.consumeOneBar(),console.log("%c RAGE BAR CONSUMED ‚Äî HOLD FOR 10s OF FULL-AUTO!","color: red; font-size: 16px"))},RageMeter.prototype.consumeOneBar=function(){this.count--,this.updateVisuals(),this.rageActive=!0,this.rageEndTime=performance.now()/1e3+this.boostDuration,this.app.fire("rage:boost",!0,this.boostMultiplier),setTimeout((()=>{performance.now()/1e3>=this.rageEndTime&&this.endRage()}),1e3*this.boostDuration)},RageMeter.prototype.endRage=function(){this.rageActive=!1,this.isHolding=!1,this.app.fire("rage:boost",!1,1),this.updateVisuals(),console.log("RAGE ENDED ‚Äî re-hold for next bar")},RageMeter.prototype.update=function(t){const e=performance.now()/1e3;if(this.rageActive){const t=Math.sin(10*e)>0?1:.5;this.bars.forEach(((e,i)=>{e.element.opacity=i<this.count?1:t}))}this.isHolding&&this.rageActive&&e<this.rageEndTime&&this.shootEntity.script.shoot.fireBulleter(),this.rageActive&&e>=this.rageEndTime&&this.endRage(),this.setButtonEnabled(!this.rageActive&&this.count>0)},RageMeter.prototype.setButtonEnabled=function(t){this.boostButton.element.opacity=t?1:.5,this.boostButton.button.enabled=t,this.boostLabel&&(this.boostLabel.element.text=t?`RAGE: ${this.count}`:"RAGE: RECHARGING...")},RageMeter.prototype.updateVisuals=function(){this.bars.forEach(((t,e)=>{t&&(t.element.opacity=e<this.count?1:0)})),this.setButtonEnabled(this.count>0&&!this.rageActive)},RageMeter.prototype.resetRage=function(){this.count=0,this.rageActive=!1,this.isHolding=!1,this.rageEndTime=0,this.app.fire("rage:boost",!1,1),this.updateVisuals(),console.log("Rage meter fully reset!")};var MobileShoot=pc.createScript("mobileShoot");MobileShoot.prototype.initialize=function(){if(console.log("[MobileShoot] Initializing..."),this.player=this.app.root.findByName("68e071c81df78dfe0f1d9e5f (1)"),this.shoot=this.player?.script?.shoot,!this.shoot)return void console.error("[MobileShoot] shoot.js not found on player!");const o=this.entity.button;o?(this.holding=!1,this.lastMobileFireTime=0,this.normalCooldown=.9,this.rageCooldown=.03,o.on("mousedown",(()=>{this.holding=!0,this.fireMobileBullet()})),o.on("touchstart",(o=>{o.event.preventDefault(),this.holding=!0,this.fireMobileBullet()})),o.on("mouseup",(()=>{this.holding=!1})),o.on("touchend",(()=>{this.holding=!1})),o.on("mouseleave",(()=>{this.holding=!1})),console.log("[MobileShoot] Initialized successfully")):console.error("[MobileShoot] Button component missing!")},MobileShoot.prototype.update=function(o){this.shoot&&this.holding&&this.shoot.isRageActive&&this.fireMobileBullet()},MobileShoot.prototype.fireMobileBullet=function(){const o=performance.now()/1e3,t=this.shoot.isRageActive?this.rageCooldown:this.normalCooldown;o<this.lastMobileFireTime+t||(this.shoot.fireBullet(),this.lastMobileFireTime=o,this.shoot.startGlow(),this.shoot.isRageActive||this.shoot.scheduleGlowStop(),this.shoot.playerModel?.anim&&this.shoot.playerModel.anim.setTrigger("Shoot"),console.log(`[MobileShoot] Fired | Rage: ${this.shoot.isRageActive} | Cooldown: ${t}s`))};var SupabaseLeaderboard=pc.createScript("supabaseLeaderboard");SupabaseLeaderboard.attributes.add("projectUrl",{type:"string",default:"https://nkwjrmkuydybmtbtmjhm.supabase.co"}),SupabaseLeaderboard.attributes.add("anonKey",{type:"string"}),SupabaseLeaderboard.attributes.add("usernameText",{type:"entity",title:"Username Text Entity"}),SupabaseLeaderboard.prototype.initialize=function(){var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2",e.onload=()=>{console.log("Supabase loaded dynamically"),this.setupSupabase()},e.onerror=()=>console.error("Failed to load Supabase"),document.head.appendChild(e)},SupabaseLeaderboard.prototype.setupSupabase=function(){const{createClient:e}=supabase;this.supabase=e(this.projectUrl,this.anonKey),this.loadOrCreateGuest()},SupabaseLeaderboard.prototype.loadOrCreateGuest=async function(){const{data:{session:e}}=await this.supabase.auth.getSession();let s;if(e&&e.user)s=e.user,console.log("Using existing anonymous session");else{const{data:e,error:a}=await this.supabase.auth.signInAnonymously();if(a||!e.user)return void console.error("Anonymous sign-in failed:",a);s=e.user,console.log("New anonymous user created")}if(!s)return;this.userId=s.id;const{data:a,error:t}=await this.supabase.from("profiles").select("username").eq("id",this.userId).single();if(t&&"PGRST116"!==t.code&&console.error("Profile fetch failed:",t),a&&a.username)this.username=a.username,console.log("Loaded saved username:",this.username);else{let e="unknown";try{const s=document.createElement("canvas"),a=s.getContext("webgl")||s.getContext("experimental-webgl");if(a){const s=a.getExtension("WEBGL_debug_renderer_info");s&&(e=a.getParameter(s.UNMASKED_RENDERER_WEBGL)||"unknown")}}catch(s){e="device_"+Date.now().toString(36)}e=String(e),this.username="ZombieSlayer_"+e.substring(0,12).replace(/[^a-zA-Z0-9]/g,"")+Math.floor(1e4*Math.random()),await this.supabase.from("profiles").insert({id:this.userId,username:this.username}),console.log("New username created and saved:",this.username)}localStorage.setItem("playerUsername",this.username),this.displayUsername()},SupabaseLeaderboard.prototype.displayUsername=function(){this.usernameText&&this.usernameText.element?(this.usernameText.element.text="Hello üôÇ: "+this.username,console.log("Username displayed:",this.username)):console.warn("UsernameText entity not assigned!")},SupabaseLeaderboard.prototype.submitScore=async function(e,s){if(!this.userId||!this.username)return void console.error("No user logged in");const a=10*e+s,{error:t}=await this.supabase.from("global_scores").insert({user_id:this.userId,username:this.username,survival_time:e,zombies_killed:s});t?console.error("Global score submit failed:",t):console.log("Global score submitted");const{data:r,error:n}=await this.supabase.from("tournament_entries").select("tournament_id").eq("username",this.username);if(!n&&r&&0!==r.length)for(const t of r){const r=t.tournament_id,{data:n}=await this.supabase.from("tournaments").select("active, ends_at").eq("id",r).single();if(!n||!n.active||new Date(n.ends_at)<new Date)continue;const{data:o}=await this.supabase.from("tournament_scores").select("high_score").eq("tournament_id",r).eq("username",this.username).single();if(o&&a<=o.high_score)continue;const{error:i}=await this.supabase.from("tournament_scores").upsert({tournament_id:r,username:this.username,high_score:a,survival_time:e,zombies_killed:s},{onConflict:["tournament_id","username"]});i?console.error("Tournament score upsert failed:",i):console.log("Tournament score updated:",a)}else console.log("No tournament entries found")};var GameEndManager=pc.createScript("gameEndManager");GameEndManager.attributes.add("playerEntity",{type:"entity",title:"Player Entity"}),GameEndManager.attributes.add("gameOverScreen",{type:"entity",title:"Game Over Screen"}),GameEndManager.attributes.add("survivalTimeText",{type:"entity",title:"Survival Time Text (Game Over)"}),GameEndManager.attributes.add("zombiesKilledText",{type:"entity",title:"Zombies Killed Text (Game Over)"}),GameEndManager.attributes.add("finalScoreText",{type:"entity",title:"Final Score Text (Game Over)"}),GameEndManager.attributes.add("liveSurvivalTimeText",{type:"entity",title:"Live Survival Time Text (HUD)"}),GameEndManager.attributes.add("liveZombiesKilledText",{type:"entity",title:"Live Zombies Killed Text (HUD)"}),GameEndManager.prototype.initialize=function(){this.survivalStartTime=Date.now(),this.pausedStartTime=0,this.totalPausedTime=0,this.zombiesKilled=0,this.gameEnded=!1,this.attackDetected=!1,this.attackTimer=null,this.gameOverScreen&&(this.gameOverScreen.enabled=!1),this.app.on("zombie:died",this.onZombieDied,this),console.log("GameEndManager ready")},GameEndManager.prototype.onZombieDied=function(e){this.gameEnded||(this.zombiesKilled+=1,console.log("KILL COUNTED! Total:",this.zombiesKilled),this.updateLiveKills())},GameEndManager.prototype.update=function(e){if(!this.gameEnded)if(this.pausedStartTime>0)this.totalPausedTime+=e;else if(this.updateLiveTime(),this.updateLiveKills(),!this.attackDetected)for(var t=this.app.root.find((function(e){return e.script&&e.script.zombieController})),i=0;i<t.length;i++){var a=t[i].script.zombieController;if(a&&a.isAttacking)return console.log("Attack detected! 3s timer..."),this.attackDetected=!0,void this.startAttackTimer()}},GameEndManager.prototype.updateLiveTime=function(){var e=Date.now()-this.survivalStartTime,t=1e3*this.totalPausedTime,i=Math.floor((e-t)/1e3);this.liveSurvivalTimeText&&this.liveSurvivalTimeText.element&&(this.liveSurvivalTimeText.element.text="Time: "+i+"s")},GameEndManager.prototype.pauseTime=function(){this.pausedStartTime=Date.now(),console.log("Survival time paused")},GameEndManager.prototype.resumeTime=function(){this.pausedStartTime>0&&(this.totalPausedTime+=(Date.now()-this.pausedStartTime)/1e3,this.pausedStartTime=0,console.log("Survival time resumed"))},GameEndManager.prototype.updateLiveKills=function(){this.liveZombiesKilledText&&this.liveZombiesKilledText.element&&(this.liveZombiesKilledText.element.text="Kills: "+this.zombiesKilled)},GameEndManager.prototype.startAttackTimer=function(){this.attackTimer=setTimeout((()=>{this.endGame()}),3e3)},GameEndManager.prototype.endGame=function(){if(!this.gameEnded){this.gameEnded=!0,this.attackTimer&&clearTimeout(this.attackTimer);var e=Date.now()-this.survivalStartTime,t=1e3*this.totalPausedTime;this.survivalTime=Math.floor((e-t)/1e3),console.log("GAME OVER! Time:",this.survivalTime,"Kills:",this.zombiesKilled),this.playerEntity&&this.playerEntity.script&&this.playerEntity.script.playerController&&(this.playerEntity.script.playerController.enabled=!1);var i=this.app.root.findByName("ZombieSpawner");i&&i.script&&i.script.zombieSpawner&&(i.script.zombieSpawner.enabled=!1);var a=this.app.root.findByName("2D Joypad Screen");a&&(a.enabled=!1,a.screen&&(a.screen.enabled=!1));var r=this.app.root.findByName("RageMeterUI");if(r&&(r.enabled=!1,r.screen&&(r.screen.enabled=!1)),this.gameOverScreen&&(this.gameOverScreen.enabled=!0),this.survivalTimeText&&(this.survivalTimeText.element.text="Survival Time: "+this.survivalTime+"s"),this.zombiesKilledText&&(this.zombiesKilledText.element.text="Zombies Killed: "+this.zombiesKilled),this.finalScoreText){var s=10*this.survivalTime+this.zombiesKilled;this.finalScoreText.element.text="Final Score: "+s}var n=this.app.root.find((function(e){return e.script&&e.script.supabaseLeaderboard}))[0];n&&n.script.supabaseLeaderboard?(n.script.supabaseLeaderboard.submitScore(this.survivalTime,this.zombiesKilled),console.log("Score submitted via safe lookup")):console.error("supabaseLeaderboard script not found! Attach it to Root.")}},GameEndManager.prototype.restartGame=function(){this.gameEnded=!1,this.attackDetected=!1,this.survivalStartTime=Date.now(),this.totalPausedTime=0,this.pausedStartTime=0,this.zombiesKilled=0,this.playerEntity&&this.playerEntity.script.playerController&&(this.playerEntity.script.playerController.enabled=!0);var e=this.app.root.findByName("ZombieSpawner");e&&e.script.zombieSpawner&&(e.script.zombieSpawner.enabled=!0),this.app.root.find((function(e){return e.script&&e.script.zombieController})).forEach((function(e){e&&e.destroy&&e.destroy()}));var t=this.app.root.findByName("2D Joypad Screen");t&&(t.enabled=!0);var i=this.app.root.findByName("RageMeterUI");i&&(i.enabled=!0,i.script&&i.script.rageMeter&&i.script.rageMeter.resetRage()),this.gameOverScreen&&(this.gameOverScreen.enabled=!1),this.updateLiveTime(),this.updateLiveKills()};var RestartButton=pc.createScript("restartButton");RestartButton.prototype.initialize=function(){this.entity.element.on("click",this.onClick,this),console.log("RestartButton ready")},RestartButton.prototype.onClick=function(){console.log("Restart button clicked!");var t=this.app.root.find((function(t){return t.script&&t.script.gameEndManager}));t&&t.length>0?(t[0].script.gameEndManager.restartGame(),console.log("Restart triggered successfully!")):console.error("ERROR: No entity with gameEndManager script found! Attach it to Root or a manager entity.")};var PauseButton=pc.createScript("pauseButton");PauseButton.prototype.initialize=function(){this.entity.button.on("click",this.togglePause,this),this.paused=!1,console.log("Pause button ready")},PauseButton.prototype.togglePause=function(e){e&&e.stopPropagation(),this.paused=!this.paused,this.app.timeScale=this.paused?0:1,this.entity.element.opacity=this.paused?.5:1;var s=this.app.root.findByName("BGM");s&&s.sound&&s.sound.slots&&(this.paused?s.sound.pause():s.sound.resume());var t=this.app.root.findByName("BGM");t&&t.script&&t.script.backgroundMusic&&(this.paused?t.script.backgroundMusic.pause():t.script.backgroundMusic.resume());var a=this.app.root.findByName("2D Joypad Screen");a?(a.enabled=!this.paused,a.screen&&(a.screen.enabled=!this.paused),console.log("Joypad Screen",this.paused?"disabled":"enabled")):console.warn("2D Joypad Screen not found - check name!");var i=this.app.root.find((function(e){return e.script&&e.script.gameEndManager}))[0];i&&i.script.gameEndManager&&(this.paused?i.script.gameEndManager.pauseTime():i.script.gameEndManager.resumeTime()),console.log("Game paused:",this.paused)};var ForceLandscape=pc.createScript("forceLandscape");ForceLandscape.prototype.initialize=function(){screen.orientation.lock("landscape").catch((()=>{}))};var BackgroundMusic=pc.createScript("backgroundMusic");BackgroundMusic.attributes.add("bgmAsset",{type:"asset",assetType:"audio",title:"Background Music Asset"}),BackgroundMusic.attributes.add("volume",{type:"number",default:.3,title:"Volume (0-1)"}),BackgroundMusic.prototype.initialize=function(){this.bgmAsset&&this.bgmAsset.resource?(this.bgmEntity=new pc.Entity("BGM"),this.bgmEntity.addComponent("sound"),this.bgmEntity.sound.addSlot("bgm",{asset:this.bgmAsset.id,volume:!1!==this.app.musicEnabled?this.volume:0,loop:!0,autoPlay:!0,overlap:!1}),this.app.root.addChild(this.bgmEntity),console.log("Background music started (looping)"),this.app.on("music:toggle",(t=>{this.bgmEntity&&this.bgmEntity.sound&&this.bgmEntity.sound.slots.bgm&&(this.bgmEntity.sound.slots.bgm.volume=t?this.volume:0)}))):console.warn("No BGM asset assigned!")},BackgroundMusic.prototype.pause=function(){this.bgmEntity&&this.bgmEntity.sound&&this.bgmEntity.sound.pause("bgm")},BackgroundMusic.prototype.resume=function(){this.bgmEntity&&this.bgmEntity.sound&&this.bgmEntity.sound.resume("bgm")};var BackButton=pc.createScript("backButton");BackButton.attributes.add("sceneName",{type:"string",default:"test",title:"Target Scene Name"}),BackButton.prototype.initialize=function(){this.entity.button.on("click",this.onClick,this),console.log("Back button ready - will switch to scene:",this.sceneName)},BackButton.prototype.onClick=function(){console.log("Back button clicked - changing scene to:",this.sceneName),this.app.scenes.changeScene(this.sceneName,(function(e){e?console.error("Scene change failed:",e):console.log("Successfully switched to new scene!")}))};var LeaderboardManager=pc.createScript("leaderboardManager");LeaderboardManager.attributes.add("projectUrl",{type:"string",title:"Supabase Project URL"}),LeaderboardManager.attributes.add("anonKey",{type:"string",title:"Supabase Anon Key"}),LeaderboardManager.prototype.initialize=function(){var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2",e.onload=()=>{console.log("Supabase library loaded dynamically"),this.setupSupabase()},e.onerror=()=>console.error("Failed to load Supabase library"),document.head.appendChild(e)},LeaderboardManager.prototype.setupSupabase=function(){this.supabase=supabase.createClient(this.projectUrl,this.anonKey),this.rankTexts=[];for(let e=1;e<=10;e++){const a=this.app.root.findByName("Rank"+e);a&&a.element&&(this.rankTexts[e-1]=a.element)}this.loadLeaderboard()},LeaderboardManager.prototype.loadLeaderboard=async function(){try{const{data:e,error:a}=await this.supabase.from("global_scores").select("username, score, survival_time, zombies_killed").order("score",{ascending:!1}).limit(10);if(a)throw a;for(let a=0;a<10;a++){const r=this.rankTexts[a];if(r)if(a<e.length){const t=e[a],o=a+1;r.text=`${o}. ${t.username} ‚Äî Score: ${t.score} (Time: ${t.survival_time}s, Kills: ${t.zombies_killed})`}else r.text=`${a+1}. ‚Äî`}console.log("Leaderboard loaded:",e.length,"entries")}catch(e){console.error("Load failed:",e)}};var ScrollController=pc.createScript("scrollController");ScrollController.attributes.add("entryTemplateAssets",{type:"asset",assetType:"template",array:!0}),ScrollController.attributes.add("initialEntryCount",{type:"number",default:15}),ScrollController.prototype._onAddRandomEntry=function(){var t=Math.floor(pc.math.random(0,this.entryTemplateAssets.length)),n=this.entryTemplateAssets[t].resource.instantiate();n.reparent(this._content),n.on("destroy",(function(){this._content.fire("contentchanged")}),this),this._content.fire("contentchanged")},ScrollController.prototype.initialize=function(){this._content=this.entity.scrollview.contentEntity,"string"==typeof this._content&&(this._content=this.app.getEntityFromIndex(this._content)),this.entity.on("addrandomentry",this._onAddRandomEntry,this);for(var t=0;t<this.initialEntryCount;++t)this._onAddRandomEntry()};var Entry=pc.createScript("entry");Entry.attributes.add("textEntity",{type:"entity"}),Entry.attributes.add("removeButtonEntity",{type:"entity"}),Entry.prototype.initialize=function(){this.textEntity.element.text=Math.floor(pc.math.random(0,1e5)).toString(),this.removeButtonEntity.button.on("click",(function(t){this.entity.destroy()}),this)};var ScrollVerticalAreaFitter=pc.createScript("scrollVerticalAreaFitter");ScrollVerticalAreaFitter.prototype._onContentChanged=function(){var t=this.entity.layoutgroup;if(t){for(var e=t.padding.y+t.padding.w,i=0,n=this.entity.children,r=0;r<n.length;++r){var a=n[r];a.layoutchild&&(i+=1,e+=a.element.height)}e+=Math.max(0,i-1)*t.spacing.y,this.entity.element.height=e}},ScrollVerticalAreaFitter.prototype.initialize=function(){this.entity.on("contentchanged",this._onContentChanged,this),this._onContentChanged()};var AddEntryButton=pc.createScript("addEntryButton");AddEntryButton.attributes.add("scrollControllerEntity",{type:"entity"}),AddEntryButton.prototype.initialize=function(){this.entity.button.on("click",(function(t){this.scrollControllerEntity.fire("addrandomentry")}),this)};var TournamentList=pc.createScript("tournamentList");TournamentList.attributes.add("projectUrl",{type:"string",default:"https://nkwjrmkuydybmtbtmjhm.supabase.co"}),TournamentList.attributes.add("anonKey",{type:"string"}),TournamentList.attributes.add("template",{type:"entity",title:"Template Entity"}),TournamentList.attributes.add("content",{type:"entity",title:"Content Entity"}),TournamentList.attributes.add("yourPhoneNumber",{type:"string",default:"2348100000000",title:"Your WhatsApp Number"}),TournamentList.prototype.initialize=function(){var t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2",t.onload=()=>{console.log("Supabase loaded"),this.setupSupabase()},t.onerror=()=>console.error("Supabase load failed"),document.head.appendChild(t)},TournamentList.prototype.setupSupabase=function(){const{createClient:t}=supabase;this.supabase=t(this.projectUrl,this.anonKey),this.refreshList()},TournamentList.prototype.refreshList=async function(){try{const{data:t,error:e}=await this.supabase.from("tournaments").select("*").eq("active",!0).order("created_at",{ascending:!1});if(e)throw e;this.content.children.forEach((t=>{t!==this.template&&t.destroy()}));const n=150;t.forEach((t=>{const e=this.template.clone();e.enabled=!0,this.content.addChild(e),e.findByName("NameText").element.text=t.name||"Unnamed Tournament",e.findByName("CreatorText").element.text="Creator: "+(t.creator_username||"Unknown"),e.findByName("PrizeText").element.text="Prize: ‚Ç¶"+(t.current_pool||0),e.findByName("PlayersText").element.text="Players: "+(t.player_count||0),e.findByName("TimeLeftText").element.text="Time Left: "+this.formatTime(t.ends_at),e.findByName("TournamentIDText").element.text="ID: "+t.id;const n=e.findByName("JoinButton");if(n&&n.script&&n.script.createTournamentRequest){const e=n.script.createTournamentRequest;e.tournamentId=t.id,e.tournamentName=t.name||"Unnamed Tournament",e.minEntry=t.min_entry,e.maxEntry=t.max_entry}}));const a=t.length*n+5e3;this.content.element.height=Math.max(600,a),this.content.layoutgroup&&this.content.layoutgroup.calculateLayout(),this.content.scrollview.recalculateScrollbars(),console.log("Tournament list refreshed:",t.length,"items | Content height:",this.content.element.height)}catch(t){console.error("Load failed:",t)}},TournamentList.prototype.formatTime=function(t){if(!t)return"Unknown";const e=new Date(t)-new Date;if(e<=0)return"Ended";return Math.floor(e/36e5)+"h "+Math.floor(e%36e5/6e4)+"m"};var TournamentCreator=pc.createScript("tournamentCreator");TournamentCreator.attributes.add("projectUrl",{type:"string",default:"https://nkwjrmkuydybmtbtmjhm.supabase.co"}),TournamentCreator.attributes.add("anonKey",{type:"string"}),TournamentCreator.prototype.initialize=function(){var t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2",t.onload=()=>{console.log("Supabase loaded dynamically"),this.setupSupabase()},t.onerror=()=>console.error("Failed to load Supabase"),document.head.appendChild(t)},TournamentCreator.prototype.setupSupabase=function(){const{createClient:t}=supabase;this.supabase=t(this.projectUrl,this.anonKey);const e=this.app.root.script.supabaseLeaderboard;e&&e.userId?(this.userId=e.userId,this.username=e.username,this.coins=e.coins||1e4,this.coinsText&&(this.coinsText.element.text="Coins: "+this.coins),this.entity.button.on("click",this.showCreatePrompt,this)):console.warn("No user logged in")},TournamentCreator.prototype.showCreatePrompt=function(){const t=prompt(`CREATE TOURNAMENT\n\nCurrent Coins: ${this.coins}\n\nEnter details (separated by commas):\nMin Entry, Max Entry, Duration in hours\n\nExample: 100, 10000, 6`,"100, 10000, 6");if(!t)return;const e=t.split(",").map((t=>t.trim()));if(3!==e.length)return void alert("Invalid format. Use: min, max, hours");const r=parseInt(e[0]),n=parseInt(e[1]),a=parseInt(e[2]);isNaN(r)||isNaN(n)||isNaN(a)||r<=0||n<r||a<=0?alert("Invalid values!"):this.coins<r?alert("Not enough coins!"):this.createTournament(r,n,a)},TournamentCreator.prototype.createTournament=async function(t,e,r){const n=new Date(Date.now()+36e5*r),a=`${this.username}'s Tournament - ${r}h`,{data:s,error:o}=await this.supabase.from("tournaments").insert({creator_id:this.userId,creator_username:this.username,name:a,min_entry:t,max_entry:e,current_pool:t,duration_hours:r,ends_at:n.toISOString()}).select();if(o)return console.error("Create failed:",o),void alert("Failed to create");this.coins-=t,localStorage.setItem("playerCoins",this.coins),alert(`Tournament created!\nName: ${a}\nID: ${s[0].id}`);const i=this.app.root.findByName("TournamentListScrollView");i&&i.script.tournamentList&&i.script.tournamentList.refreshList()};var TournamentRequest=pc.createScript("tournamentRequest");TournamentRequest.attributes.add("yourPhoneNumber",{type:"string",default:"2348100000000",title:"Your WhatsApp Number"}),TournamentRequest.prototype.initialize=function(){this.entity.button.on("click",this.requestTournament,this)},TournamentRequest.prototype.requestTournament=function(){const t=localStorage.getItem("playerUsername")||"UnknownPlayer",e=prompt(`REQUEST REAL-MONEY TOURNAMENT\n\nPlayer: ${t}\n\nEnter details (separated by commas):\nMin Entry (NGN), Max Entry (NGN), Duration (hours)\n\nExample: 500, 5000, 6`,"500, 5000, 6");if(!e)return;const n=e.split(",").map((t=>t.trim()));if(3!==n.length)return void alert("Invalid format. Use: min, max, hours");const r=n[0],o=n[1],a=n[2],u=encodeURIComponent(`*New Tournament Request!*\n\nPlayer: ${t}\nMin Entry: ‚Ç¶${r}\nMax Entry: ‚Ç¶${o}\nDuration: ${a} hours\n\nPlease set up the tournament and confirm payment details.`),s=`https://wa.me/${this.yourPhoneNumber}?text=${u}`;window.open(s,"_blank"),alert("Request sent! I will set up your tournament soon.")};var CreateTournamentRequest=pc.createScript("createTournamentRequest");CreateTournamentRequest.attributes.add("yourPhoneNumber",{type:"string",default:"2348100000000",title:"Your WhatsApp Number"}),CreateTournamentRequest.attributes.add("projectUrl",{type:"string",default:"https://nkwjrmkuydybmtbtmjhm.supabase.co"}),CreateTournamentRequest.attributes.add("anonKey",{type:"string"}),CreateTournamentRequest.prototype.initialize=function(){var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2",e.onload=()=>{console.log("Supabase loaded dynamically"),this.setupSupabase()},e.onerror=()=>console.error("Failed to load Supabase"),document.head.appendChild(e),this.entity.button.on("click",this.onJoinClick,this)},CreateTournamentRequest.prototype.setupSupabase=function(){const{createClient:e}=supabase;this.supabase=e(this.projectUrl,this.anonKey)},CreateTournamentRequest.prototype.onJoinClick=async function(){const e=localStorage.getItem("playerUsername")||localStorage.getItem("playerId")||"";let t=prompt("Enter Tournament Name:","").trim();if(!t)return void alert("Tournament Name is required.");let n,r,a=prompt("Enter Tournament ID:","").trim();if(!a)return void alert("Tournament ID is required.");try{const{data:e,error:t}=await this.supabase.from("tournaments").select("min_entry, max_entry").eq("id",a).single();if(t)throw t;if(!e)return void alert("Tournament not found in database.");n=e.min_entry,r=e.max_entry}catch(e){return console.error("Fetch error:",e),void alert("Failed to fetch tournament details. Please try again.")}let o=prompt("Enter Your Player ID / Username:",e).trim();if(!o)return void alert("Player ID / Username is required.");let s=prompt(`Enter amount to pay (‚Ç¶${n} - ‚Ç¶${r}):`,n.toString());if(!s)return;const u=parseInt(s.trim(),10);if(isNaN(u)||u<n||u>r)return void alert(`Please enter a valid amount between ‚Ç¶${n} and ‚Ç¶${r}`);const i=encodeURIComponent(`*New Join Request!*\n\nTournament: ${t}\nTournament ID: ${a}\nPlayer ID: ${o}\nAmount to Pay: ‚Ç¶${u}\n\nPlease confirm payment and add the player to the tournament.\nThank you!`);window.open(`https://wa.me/${this.yourPhoneNumber}?text=${i}`,"_blank"),alert("Join request sent successfully! You will be added soon.")};var JoinTournament=pc.createScript("joinTournament");JoinTournament.attributes.add("yourPhoneNumber",{type:"string",default:"2348100000000"}),JoinTournament.prototype.initialize=function(){this.entity.button.on("click",this.onJoin,this)},JoinTournament.prototype.onJoin=function(){const n=localStorage.getItem("playerUsername")||"Unknown Player",t=this.entity.parent,e=t.findByName("NameText"),o=t.findByName("TournamentIDText");if(!e||!o)return alert("Tournament data not found. Contact support."),void console.error("Missing NameText or TournamentIDText");const r=e.element.text,a=o.element.text,i=prompt(`JOIN TOURNAMENT\n\nTournament: ${r}\nPlayer: ${n}\n\nEnter amount to pay:`,"500");if(!i)return;const m=parseInt(i.trim());if(isNaN(m)||m<=0)return void alert("Enter a valid amount");const u=encodeURIComponent(`*New Join Request!*\n\nPlayer: ${n}\nTournament: ${r}\nTournament ID: ${a}\nAmount: ‚Ç¶${m}\n\nPlease add player and confirm payment.`);window.open(`https://wa.me/${this.yourPhoneNumber}?text=${u}`,"_blank"),alert("Join request sent!")};var MyTournaments=pc.createScript("myTournaments");MyTournaments.attributes.add("projectUrl",{type:"string",default:"https://nkwjrmkuydybmtbtmjhm.supabase.co"}),MyTournaments.attributes.add("anonKey",{type:"string"}),MyTournaments.attributes.add("template",{type:"entity",title:"Template Entity"}),MyTournaments.attributes.add("content",{type:"entity",title:"Content Entity"}),MyTournaments.prototype.initialize=function(){var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2",e.onload=()=>{console.log("Supabase loaded dynamically"),this.setupSupabase()},e.onerror=()=>console.error("Failed to load Supabase"),document.head.appendChild(e)},MyTournaments.prototype.setupSupabase=function(){const{createClient:e}=supabase;this.supabase=e(this.projectUrl,this.anonKey),this.refreshList()},MyTournaments.prototype.refreshList=async function(){try{const e=localStorage.getItem("playerUsername")||"Unknown",{data:t,error:n}=await this.supabase.from("tournaments").select("*").eq("creator_username",e).order("created_at",{ascending:!1});if(n)throw n;const{data:a,error:r}=await this.supabase.from("tournament_entries").select("tournament_id").eq("username",e);if(r)throw r;const o=a.map((e=>e.tournament_id)),{data:s,error:i}=await this.supabase.from("tournaments").select("*").in("id",o).order("created_at",{ascending:!1});if(i)throw i;const c=[...t,...s].reduce(((e,t)=>e.find((e=>e.id===t.id))?e:e.concat([t])),[]);if(console.log("Fetched",c.length,"tournaments"),!this.content||!this.content.children)return void console.error("Content entity not found");this.content.children.forEach((e=>{e!==this.template&&e.destroy()}));const d=150;let u=0;c.forEach((t=>{const n=this.template.clone();n.enabled=!0,this.content.addChild(n),n.findByName("NameText").element.text=t.name||"Unnamed",n.findByName("StatusText").element.text=t.active?"Ongoing":"Ended",n.findByName("MyScoreText").element.text="My High Score: "+(t.my_high_score||0),n.findByName("TournamentIDText").element.text="ID: "+t.id,t.active?n.findByName("WinnerText").element.text="Progress: "+t.player_count+" players joined":t.winner_username===e?n.findByName("WinnerText").element.text="Congrats! You won with high score: "+t.winner_score:n.findByName("WinnerText").element.text="Sorry, you lost. Winner: "+t.winner_username+" with "+t.winner_score;const a=n.findByName("WithdrawButton");a&&a.script&&a.script.withdrawRequest&&(a.script.withdrawRequest.tournamentId=t.id),u+=d})),this.content.element.height=Math.max(600,u+100),this.content.layoutgroup&&this.content.layoutgroup.calculateLayout(),this.content.scrollview.recalculateScrollbars()}catch(e){console.error("Load failed:",e)}},MyTournaments.prototype.formatTime=function(e){if(!e)return"Unknown";const t=new Date(e)-new Date;if(t<=0)return"Ended";return Math.floor(t/36e5)+"h "+Math.floor(t%36e5/6e4)+"m"};var WithdrawRequest=pc.createScript("withdrawRequest");WithdrawRequest.attributes.add("yourPhoneNumber",{type:"string",default:"2348100000000",title:"Your WhatsApp Number"}),WithdrawRequest.attributes.add("projectUrl",{type:"string",default:"https://nkwjrmkuydybmtbtmjhm.supabase.co"}),WithdrawRequest.attributes.add("anonKey",{type:"string"}),WithdrawRequest.prototype.initialize=function(){var t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2",t.onload=()=>{console.log("Supabase loaded dynamically"),this.setupSupabase()},t.onerror=()=>console.error("Failed to load Supabase"),document.head.appendChild(t),this.entity.button.enabled=!1,this.entity.button.on("click",this.onWithdrawClick,this)},WithdrawRequest.prototype.setupSupabase=function(){const{createClient:t}=supabase;this.supabase=t(this.projectUrl,this.anonKey),setTimeout((()=>{const t=this.entity.parent.findByName("WinnerText");t&&t.element&&t.element.text.startsWith("Congrats!")?(this.entity.button.enabled=!0,console.log("Withdraw button enabled for winner")):console.log("Not the winner ‚Äî button remains disabled")}),500)},WithdrawRequest.prototype.onWithdrawClick=async function(){const t=localStorage.getItem("playerUsername")||localStorage.getItem("playerId")||"";let e=prompt("Enter Tournament Name:","").trim();if(!e)return void alert("Tournament Name is required.");let n=prompt("Enter Tournament ID:","").trim();if(!n)return void alert("Tournament ID is required.");let r=prompt("Enter Your Player ID / Username:",t).trim();if(!r)return void alert("Player ID / Username is required.");let a=prompt("Enter Your Bank Account Info (for payout):","").trim();if(!a)return void alert("Bank Account Info is required.");const o=encodeURIComponent(`*New Withdraw Request!*\n\nTournament: ${e}\nTournament ID: ${n}\nPlayer ID: ${r}\nBank Info: ${a}\n\nPlease confirm and process the payout.\nThank you!`);window.open(`https://wa.me/${this.yourPhoneNumber}?text=${o}`,"_blank"),alert("Withdraw request sent successfully! You will be paid soon.")};var AudioToggle=pc.createScript("audioToggle");AudioToggle.attributes.add("type",{type:"string",enum:[{"Sound Effects":"sfx"},{"Background Music":"music"}],default:"sfx",title:"Toggle Type"}),AudioToggle.attributes.add("onSprite",{type:"asset",assetType:"sprite",title:"On Icon"}),AudioToggle.attributes.add("offSprite",{type:"asset",assetType:"sprite",title:"Off Icon"}),AudioToggle.prototype.initialize=function(){this.isOn=!0,this.updateVisual(),this.entity.button.on("click",this.toggle,this)},AudioToggle.prototype.toggle=function(){if(this.isOn=!this.isOn,"sfx"===this.type)this.app.soundEnabled=this.isOn;else{const t=this.app.root.findByName("BGM");t&&t.sound&&(t.sound.slots.bgm.volume=this.isOn?.3:0),this.app.musicEnabled=this.isOn}this.updateVisual(),console.log(this.type+" toggled:",this.isOn?"ON":"OFF")},AudioToggle.prototype.updateVisual=function(){const t=this.isOn?this.onSprite:this.offSprite;t&&this.entity.element&&(this.entity.element.spriteAsset=t)};var Preloader=pc.createScript("preloader");Preloader.prototype.initialize=function(){this.spinnerCircle=this.entity.findByName("SpinnerCircle"),this.entity.enabled=!1},Preloader.prototype.update=function(e){this.entity.enabled&&this.spinnerCircle&&this.spinnerCircle.rotateLocal(0,0,-180*e)};var PlayButton=pc.createScript("playButton");PlayButton.attributes.add("mainSceneName",{type:"string",default:"MainGame",title:"Main Game Scene Name"}),PlayButton.attributes.add("preloader",{type:"entity",title:"Preloader Entity"}),PlayButton.prototype.initialize=function(){this.entity.button.on("click",this.onPlayClick,this)},PlayButton.prototype.onPlayClick=function(){console.log("Play button clicked - switching to scene:",this.mainSceneName),this.preloader&&(this.preloader.enabled=!0),this.app.scenes.changeScene(this.mainSceneName,(e=>{if(e)return console.error("Failed to switch to main scene:",e),alert("Failed to load game. Please try again."),void(this.preloader&&(this.preloader.enabled=!1));console.log("Main game scene loaded successfully!"),this.preloader&&(this.preloader.enabled=!1)}))};